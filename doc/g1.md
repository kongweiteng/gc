#### Garbage First
##### What(是什么)

```text

Garbage First（简称G1）收集器是垃圾收集器技术发展历史上的里程碑式的成果，G1收集器就被视作JDK 7中HotSpot虚拟机的一项重要进化特征。
到了JDK 8 Update 40的时候，这个版本以后的G1收集器才被Oracle官方称为“全功能的垃圾收集器”（Fully-Featured Garbage Collector）。
G1是一款主要面向服务端应用的垃圾收集器。HotSpot开发团队最初赋予它的期望是（在比较长期的）未来可以替换掉JDK 5中发布的CMS收集器。
现在这个期望目标已经实现过半了，JDK 9发布之日，G1宣告取代Parallel Scavenge加Parallel Old组合，成为服务端模式下的默认垃圾收集器，
而CMS则沦落至不推荐使用（Deprecate）的收集器。

在G1收集器出现之前的所有其他收集器，包括CMS在内，垃圾收集的目标范围要么是整个新生代（Minor GC），要么就是整个老年代（Major GC），
再要么就是整个Java堆（Full GC）。而G1跳出了这个樊笼，它可以面向堆内存任何部分来组成回收集（Collection Set，一般简称CSet）进行回收，
衡量标准不再是它属于哪个分代，而是哪块内存中存放的垃圾数量最多，回收收益最大，这就是G1收集器的Mixed GC模式。

```

#### Why(为什么)

```text
G1是把连续的Java堆划分为多个大小相等的独立区域（Region），每个Region都可以根据需要，扮演新生代的Eden空间、Survivor空间或者老年代空间，
收集器能够扮演不同角色的Region采用不同的策略去处理，这样无论新创建的对象还是已经存活了一段时间、熬过多次收集的旧对象都能获得很好的收集效果。

Region中还有一类特殊的Humongous区域，专门用来存储大对象。G1中的新生代和老年代不再是固定的，他们都是一系列区域（不需要连续）的动态集。
G1将Region作为单次回收的最小单元，每次收集到的内存空间都是Region大小的整数倍，这样有计划的避免在整个Java堆中进行区域的垃圾收集。
G1收集器会跟踪各个Region里面的垃圾堆的“价值”大小，然后在后台维护一个优先级列表，优先回收收益最大的哪些Region，这也是“Garbage First”名字的由来。
这样在有限的时间内尽可能高的收集效率。

G1收集器运行过程:

初始标记（Initial Marking）
仅仅是标记GC Roots能直接关联到的对象，并且修改TAMS指针的值，让下一阶段用户线程并发运行时，能够正确地在可用的Region中分配新对象。这个阶段需要停顿线程，
但是耗时短，并且还是借用Minor GC的时候同步完成，所以G1收集器在这个阶段并没有额外的停顿。

并发标记（Concurrent Marking）
从GC Roots开始对堆中对象进行可达性分析，递归扫描整个堆中的对象图，找出要回收的对象，这个耗时较长，但可与用户程序并发执行。当对象图扫描完成以后，
还要重新处理SATB记录下的并发时有引用变动的对象。

最终标记（Final Marking）
对用户线程做另一个短暂的暂停，用于处理并发阶段结束后仍遗留下来的最后那少量的SATB记录


筛选回收（Live Data Counting and Evacuation）
负责更新Region的统计数据，对各个Region的回收价值和成本进行排序，根据用户所期望的停顿时间来制定回收计划，可以自由选择任意多个Region构成回收集，然后把决定回收的那一部分Region的存活对象复制到空Region 中，再清理掉整个旧Region的全部空间。这里的操作涉及存活对象的移动，是必须暂定用户线程，由多条收集器线程并行完成的。


```


### [GC介绍](../README.md)